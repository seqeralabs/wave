---
title: Nextflow integration
---

You can use Wave directly from your Nextflow pipelines. Wave supports private repositories, container freezing, and conda packages.

:::note
Nextflow integration requires Nextflow `22.10.0`, or later.
:::

## Get started

To enable Wave in your Nextflow pipeline, add the following to your Nextflow configuration file:

```groovy
wave {
    enabled = true
}

tower {
    accessToken = '<PLATFORM_ACCESS_TOKEN>'
}
```

Replace `<PLATFORM_ACCESS_TOKEN>` with your Seqera Platform access token.

Using a Seqera access token is optional but provides additional capabilities:

- Access to private repositories
- Higher API request limits than anonymous users

For all Nextflow configuration options, see [Configuration options](#configuration-options).

## Use Wave features with Nextflow

The following sections describe how to use Wave features with Nextflow.

### Access private container repositories

Wave allows you to use private container repositories with your Nextflow pipelines. Provide repository access keys as [Seqera Platform credentials](https://docs.seqera.io/platform/latest/credentials/overview).

<details open>
<summary>**Access private container repositories**</summary>

After creating your credentials, specify your [personal access token](https://docs.seqera.io/platform/latest/api/overview#authentication) in your pipeline configuration file.
If you created credentials in a Seqera Platform organization workspace, add your workspace ID:

```groovy
tower {
  accessToken = '<PLATFORM_ACCESS_TOKEN>'
  workspaceId = '<PLATFORM_WORKSPACE_ID>'
}
```

Replace the following:

- `<PLATFORM_ACCESS_TOKEN>`: your Platform access token
- `<PLATFORM_WORKSPACE_ID>`: your Platform organization workspace ID

By default, Wave uploads containers it builds to the AWS ECR repository `195996028523.dkr.ecr.eu-west-1.amazonaws.com/wave/build`. Images in this repository are deleted automatically one week after they are pushed.

To store Wave containers in your own container repository, add the following settings to your Nextflow configuration file:

```groovy
wave.build.repository = '<BUILD_REPOSITORY>'
wave.build.cacheRepository = '<CACHE_REPOSITORY>'
```

Replace the following:

- `<BUILD_REPOSITORY>`: the repository to store your built container images
- `<CACHE_REPOSITORY>`: the repository to store image layers for caching

When you run your pipeline with Wave, Nextflow uses credentials from the Seqera Platform credentials manager to access private container repositories.

</details>

### Build Nextflow module containers

Wave can build and provision container images on demand for your Nextflow pipelines.

<details open>
<summary>**Build Nextflow module containers**</summary>

To provision container images on demand, add the Dockerfile of the container to the [module directory](https://www.nextflow.io/docs/latest/module.html#module-directory) where the pipeline process is defined.
When Wave is enabled, it automatically uses the Dockerfile to build the required container, uploads the container to the registry, and uses the container to execute the script defined in the process.

:::warning
If a process declares a `container` directive, it takes precedence over the Dockerfile definition.
:::

To use the Dockerfile in the module directory even when a process uses a `container` directive, add the following setting to your Nextflow configuration file:

```groovy
wave.strategy = ['dockerfile','container']
```

This setting instructs Wave to prioritize the module Dockerfile over process `container` directives.

:::warning
Wave does not support `ADD`, `COPY`, or other Dockerfile commands that access files in the host file system.
:::

</details>

### Build conda-based containers

Wave can provision containers based on the [`conda` directive](https://www.nextflow.io/docs/latest/process.html#conda).
This allows you to use conda packages in your pipeline, even on cloud-native platforms like AWS Batch and Kubernetes, which do not support the conda package manager directly.

<details open>
<summary>**Build conda-based containers**</summary>

With Wave enabled, define the `conda` requirements in your pipeline processes, as long as the process does not also specify a `container` directive or a Dockerfile.

To use the `conda` directive even when a process also specifies a `container` directive or Dockerfile, add this setting to your configuration:

```groovy
wave.strategy = ['conda']
```

This setting tells Wave to use the `conda` directive to provision containers and ignore the `container` directive and Dockerfile(s).

For Nextflow 23.10.x, or later, the `conda-forge::procps-ng` package is included automatically in provisioned containers. This package includes the `ps` command.

You can set conda channels and their priority with `conda.channels`:

```groovy
wave.strategy = ['conda']
conda.channels = 'seqera,conda-forge,bioconda,defaults'
```

</details>

### Build Singularity containers

Nextflow can build Singularity native images on demand using a `Singularityfile` or conda packages.
The Singularity images are uploaded to an OCI-compliant container registry of your choice and stored as an [ORAS artifact](https://oras.land/).

:::note
Available as of Nextflow version 23.09.0-edge.
:::

<details open>
<summary>**Build Singularity containers**</summary>

:::note
This feature requires a version of Singularity (or Apptainer) that supports pulling images using the `oras:` pseudo-protocol.
:::

To enable provisioning of Singularity images in your pipeline, use the following configuration:

```groovy
singularity.enabled = true
wave.enabled = true
wave.freeze = true
wave.strategy = ['conda']
wave.build.repository = '<BUILD_REPOSITORY>'
```

Replace `<BUILD_REPOSITORY>` with the repository where your Singularity image files should be uploaded.

When using a private repository, provide repository access keys via the Seqera Platform credentials manager. For more information, see [Authenticate private repositories](https://docs.seqera.io/platform/24.1/credentials/overview).

Grant access to the repository on compute nodes with:

```bash
singularity remote login <REMOTE_NAME>
```

Replace `<REMOTE_NAME>` with your Singularity remote endpoint.

See the [Singularity remote login documentation](https://docs.sylabs.io/guides/3.1/user-guide/cli/singularity_remote_login.html) for details.

To build Singularity native images, disable both `singularity.ociAutoPull` and `singularity.ociMode` in your configuration. For more information, see the Nextflow [configuration documentation](https://www.nextflow.io/docs/latest/config.html#config-singularity).

</details>

### Use Wave with Fusion

Wave containers allow you to run your containerized workflow with the Fusion file system.

<details open>
<summary>**Use Wave with Fusion**</summary>

Wave with Fusion allows you to use an object storage bucket, such as AWS S3 or Google Cloud Storage, as your pipeline work directory. This can simplify and speed up operations on local, AWS Batch, Google Batch, or Kubernetes executions.

For more information, see:
- [Fusion documentation](https://docs.seqera.io/fusion)
- [Nextflow Fusion integration documentation](https://www.nextflow.io/docs/latest/fusion.html)

</details>

## Configuration options

The following Nextflow configuration options are available:

| Method                       | Description                                                                                                                                                              |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `wave.enabled`               | Enable/disable the execution of Wave containers                                                                                                                          |
| `wave.endpoint`              | The Wave service endpoint (default: `https://wave.seqera.io`)                                                                                                            |
| `wave.build.repository`      | The container repository where images built by Wave are uploaded. You must provide corresponding credentials in your Seqera Platform account.                            |
| `wave.build.cacheRepository` | The container repository used to cache image layers built by the Wave service. You must provide corresponding credentials in your Seqera Platform account.               |
| `wave.conda.mambaImage`      | The Mamba container image used to build conda-based containers. This should be a [micromamba-docker](https://github.com/mamba-org/micromamba-docker) image.              |
| `wave.conda.commands`        | One or more commands to add to the Dockerfile used to build a conda-based image.                                                                                         |
| `wave.strategy`              | The strategy used when resolving ambiguous Wave container requirements (default: `'container,dockerfile,conda'`)                                                         |
| `wave.freeze`                | When `freeze` mode is enabled, containers provisioned by Wave are stored permanently in the repository specified by `wave.build.repository`.                             |

## Limitations

### Use of sha256 digest in the image name

Wave does not support using a sha256 digest in the image name (for example, `ubuntu@sha256:3235...ce8f`) when using the augmentation process to extend container images.

To reference a container by sha256 digest in the image name with Wave, you must enable freeze mode and force the creation of a new container image using your specified base image.

In your pipeline configuration, specify the following settings:

```groovy
wave.enabled = true
wave.freeze = true
wave.strategy = ['dockerfile']
wave.build.repository = '<BUILD_REPOSITORY>'
```

Replace `<BUILD_REPOSITORY>` with the repository where your image files should be uploaded.
